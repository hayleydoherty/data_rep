<html>
	<head>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	</head>
	<body>
		<div id="create-update" style="display:none">
			<table id ="createUpdateForm">
			<tr>
				<td>ID</td>
				<td><input type="text" name= "ID"></td>
			</tr>
			<tr>
				<td>Title</td>
				<td><input type="text" name= "title"></td>
			</tr>
			<tr>
				<td>Director</td>
				<td><input type="text" name= "director"></td>
			</tr>
			<tr>
				<td>Year</td>
				<td><input type="int" name= "year"></td>
			</tr>			
			<tr>
				<td><button id="creat-button" onclick="doCreate()">Create</button></td>
			</tr>
			</table>
		</div>
		<div id="display">
			<h2>Films</h2>
			<button onclick="showCreate()">Create</button>
			<table id="filmTable" class="table">
				<tr>
					<th>ID</th><th>Title</th><th>Director</th><th>Year</th><th>b</th><th>b</th>
				</tr>
				<!--<tr id ="1">
					<td>1</td>
					<td>Love Actually</td>
					<td>Richard Curtis</td>
					<td>2003</td>
					<td><button onclick="Update(this)">Update</button></td>
					<td><button onclick="doDelete(this)">Delete</button></td>
				</tr>-->
			</table>
		</div>
		
		<script>
			function showCreate(){
				document.getElementById('display').style.display="none"
				document.getElementById('create-update').style.display="block"
			}
			
			function doCreate(){
				film = getFilmFromForm()
				$.ajax({
					url:"/films",
					data:JSON.stringify(film),
					method:'POST',
					dataType:'JSON',
					contentType: "application/json; charset=utf-8",
					success: function(result){
						console.log(result)
						addFilmToTable(film)
						showDisplay()
						//for (film of results){
							//addFilmToTable(film);
						},
						"error":function(xhr, status, error){
							console.log("error"+ error)
						}
				})
				
			}
			
			function doDelete(thisElem){
				var tableElement = document.getElementById('filmTable');
				var rowElement = thisElem.parentNode.parentNode;
				var index = rowElement.rowIndex;
				ID  = rowElement.getAttribute("id");
				$.ajax({
					url:"/films/"+ID,
					method:"DELETE",
					dataType:"JSON",
					success:function(result){
						tableElement.deleteRow(index);
					},
					"error":function(xhr, status, error){
						console.log(error)
					}
				})
				
			}
			
			function getFilmFromForm(){
				var form = document.getElementById('createUpdateForm')
				var film = {}
				film.id = form.querySelector('input[name="ID"]').value
				film.title = form.querySelector('input[name="title"]').value
				film.director = form.querySelector('input[name="director"]').value
				film.year = form.querySelector('input[name="year"]').value
				//console.log(film)
				return film
			}
			
			function showDisplay(){
				document.getElementById('display').style.display="block"
				document.getElementById('create-update').style.display="none"
			}
		
			function populateTable(){
				//ajax getAll
				$. ajax({
					url:'http://127.0.0.1:5000/films',
					method:'GET',
					dataType:'JSON',
					success: function(results){
						for (film of results){
							addFilmToTable(film)
						}
					},
					"error":function(xhr, status, error){
						console.log("error "+error+ "code: "+status)
					}
				})
				
			}
			function addFilmToTable(film){
				//console.log("working")
				tableElem = document.getElementById("filmTable")
				rowElem = tableElem.insertRow(-1)
				rowElem.setAttribute("id", film.id)
				cell1= rowElem.insertCell(0)
				cell1.innerHTML= film.id
				cell2= rowElem.insertCell(1)
				cell2.innerHTML= film.title
				cell3= rowElem.insertCell(2)
				cell3.innerHTML= film.director
				cell4= rowElem.insertCell(3)
				cell4.innerHTML= film.year
				cell5= rowElem.insertCell(4)
				cell5.innerHTML= '<button onclick="Update(this)">Update</button>'
				cell6= rowElem.insertCell(5)
				cell6.innerHTML= '<button onclick="doDelete(this)">Delete</button>'				
			}
			populateTable()
		</script>
	</body>

</html>